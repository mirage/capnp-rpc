<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Endpoint (capnp-rpc-net.Capnp_rpc_net.Endpoint)</title><link rel="stylesheet" href="../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">capnp-rpc-net</a> &#x00BB; <a href="../index.html">Capnp_rpc_net</a> &#x00BB; Endpoint</nav><header class="odoc-preamble"><h1>Module <code><span>Capnp_rpc_net.Endpoint</span></code></h1><p>Send and receive capnp messages over a byte-stream.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-src"><a href="#val-src" class="anchor"></a><code><span><span class="keyword">val</span> src : <span class="xref-unresolved">Logs</span>.src</span></code></div><div class="spec-doc"><p>Control the log level.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>A wrapper for a byte-stream (flow).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-send"><a href="#val-send" class="anchor"></a><code><span><span class="keyword">val</span> send : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <span class="xref-unresolved">Capnp</span>.BytesMessage.Message.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span>[ `Closed <span><span>| `Msg</span> of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>send t msg</code> transmits <code>msg</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-recv"><a href="#val-recv" class="anchor"></a><code><span><span class="keyword">val</span> recv : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><span class="xref-unresolved">Capnp</span>.Message.ro <span class="xref-unresolved">Capnp</span>.BytesMessage.Message.t</span>, <span>[&gt; `Closed ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>recv t</code> reads the next message from the remote peer. It returns <code>Error `Closed</code> if the connection to the peer is lost (this will also happen if the switch is turned off).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_flow"><a href="#val-of_flow" class="anchor"></a><code><span><span class="keyword">val</span> of_flow : 
  <span>switch:<span class="xref-unresolved">Lwt_switch</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span>peer_id:<a href="../Auth/Digest/index.html#type-t">Auth.Digest.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="keyword">module</span> <span class="xref-unresolved">Mirage_flow</span>.S <span class="keyword">with</span> <span class="keyword">type</span> <span class="xref-unresolved">flow</span> = <span class="type-var">'flow</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'flow</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>of_flow ~switch ~peer_id (module F) flow</code> sends and receives on <code>flow</code>. The caller should arrange for <code>flow</code> to be closed when the switch is turned off. If the flow is closed, the switch will be turned off. If the flow returns an error when the switch is off, the endpoint will return <code>`Closed</code> instead of the underlying error.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-peer_id"><a href="#val-peer_id" class="anchor"></a><code><span><span class="keyword">val</span> peer_id : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Auth/Digest/index.html#type-t">Auth.Digest.t</a></span></code></div><div class="spec-doc"><p><code>peer_id t</code> is the fingerprint of the peer's public key, or <code>Auth.Digest.insecure</code> TLS isn't being used.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disconnect"><a href="#val-disconnect" class="anchor"></a><code><span><span class="keyword">val</span> disconnect : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>disconnect t</code> turns off <code>t</code>'s switch.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_error : <span><span>[&lt; `Closed <span><span>| `Msg</span> of string</span> ]</span> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div></div></div></body></html>